name: GitHub â†’ Discord

on:
  push:
    branches: [ main ]
  pull_request:
    types: [opened, closed]

jobs:
  discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          PAYLOAD=$(jq -n \
            --arg repo "$GITHUB_REPOSITORY" \
            --arg event "$GITHUB_EVENT_NAME" \
            --arg actor "$GITHUB_ACTOR" \
            --arg sha "$GITHUB_SHA" \
            --arg ref "$GITHUB_REF" \
            '{
              "embeds": [{
                "title": "ðŸš€ GitHub Notification",
                "color": 4886754,
                "fields": [
                  {"name": "ðŸ“¦ Repository", "value": $repo, "inline": false},
                  {"name": "âš¡ Event", "value": $event, "inline": true},
                  {"name": "ðŸ‘¤ Triggered by", "value": $actor, "inline": true},
                  {"name": "ðŸ”€ Branch", "value": $ref, "inline": false},
                  {"name": "ðŸ§© Commit", "value": $sha, "inline": false}
                ]
              }]
            }')

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "$WEBHOOK"
